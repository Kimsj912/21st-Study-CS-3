### 파이프라인 커넥션
- 지속 커넥션을 통해서 요청을 파이프라이닝
- 응답을 기다리지 않고 계속 요청을 보내는 방식
- 지속 커넥션인지 확인하기 전까지는 파이프라인을 잇는다.(지속 커넥션이 아니면 뒤의 요청이 무시 당한다.)
-HTTP 응답은 요청 순서와 같아야 한다. HTTP 메시지는 순번이 없기 때문에 응답이 순서 없이 오면 정렬할 방법이 없다.
- HTTP 클라이언트는 도중에 커넥션이 끊기더라도 완료되지 않은 요청이 파이프에 있다면 다시 요청을 보낼 수 있어야 한다. 
- HTTP 클라이언트는 POST 요청같이 반복해서 사용할 경우 문제가 생기는 요청은 파이프라인을 통해서 보내서는 안 된다. (멱등성에 대해서 알아보자.)

### 커넥션 끊김
- 마음대로 끊음 ex) 파이프라인 지속 커넥션 (지속 커넥션이 계속 남아있게 된다면 서버가 끊어버림)
- 커넥션이 끊어지게 되면 `Content-length` 가 실제 리소스의 크기와 알맞지 않는 오류도 발생

#### 허용 재시도 멱등
- 커넥션 끊김(에러가 없어도 언제든지 끊길 수 있음)
- 전송 중에 커넥션이 끊기면 서버에서 얼만 큼의 요청이 수행됐는지 모름
   - 몇 번 실행하게 되더라고 같은 결과 값을 가진다 : `멱등` => `get`, `head`, `put`..
   - post 와 같이 여러 번 반복하면 안되는 경우에는 문제가 되므로 이때는 파이프라인을 통해 요청해서는 안됨.

#### 우아한 커넥션 끊김
![image](https://user-images.githubusercontent.com/101736358/206139546-56fa89ba-7ece-4a04-900c-7ffc572e2e3e.png)

- 전체 끊기 : 입력/출력 모두 끊는다.(`close()`호출을 통해)
- 절반 끊기 : 둘 중 하나를 끊는다.(`shutdown()`호출을 통해)

#### TCP 끊기와 리셋 에러
- 보통의 커넥션의 출력 채널을 끊는 것이 안전
- 클라이언트에서 더 이상 데이터를 보내지 않는 것을 보장하지 않는 이상 입력 채널을 끊는 것은 위험

- 클라이언트에서 서버의 끊긴 입력 채널에 데이터를 전송하면, 서버의 OS는 `TCP connection reset by peer`메시지를 클라이언트에게 보낸다.
- 버퍼에 저장된, 아직 읽지 않은 데이터를 모두 삭제
- 따라서 도착했지만, 아직 읽히지 않은 응답 데이터까지 사라질 수 있다.

#### 우아한 끊기

- 절반 끊기 를 통해 자신의 출력 채널을 먼저 끊고 상대의 출력 채널이 끊기는 것을 기다리는 것

Q1) 커넥션 끊을 때 close() 와 shutdown() 중 어떤 것이 절반 끊기 인가?
Q2) 왜 입력 채널을 끊으면 안될까?