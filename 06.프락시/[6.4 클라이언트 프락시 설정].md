# 6.4 클라이언트 프락시 설정

모든 현대적인 브라우저는 프락시를 사용할 수 있도록 설정할 수 있다. 그리고 프락시를 설정하는 여러 가지 방법을 제공한다.

<br />

#### 수동 설정

프락시를 사용하겠다고 **명시적으로 설정한다.**

<br />

#### 브라우저 기본 설정

브라우저 벤더나 배포자는 브라우저(혹은 다른 웹 클라이언트)를 **소비자에게 전달하기 전에 프락시를 미리 설정해 놓을 수 있다.**

<br />

#### 프락시 자동 설정 (Proxy auto-configuration, PAC)

자바스크립트 프락시 자동 설정(PAC)파일에 대한 URI를 제공할 수 있다. 만약 클라이언트가 프락시를 써야 한다면, **어떤 프락시 서버를 써야 하는지 판단하기 위해 그 자바스크립트 파일을 가져와서 실행한다.**

<br />

#### WPAD 프락시 발견

대부분의 브라우저는 자동설정 파일을 다운받을 수 있는 '설정 서버'를 자동으로 찾아주는, **웹 프락시 자동발견 프로토콜(Web Proxy Autodiscovery Protocol, WPAD)**을 제공한다.

<br />
<br />

## 6.4.1 클라이언트 프락시 설정: 수동

많은 웹 클라이언트가 프락시를 수동으로 설정할 수 있도록 한다. 모두 간편하게 프락시 설정을 할 수 있도록 지원한다.

- 크롬: 설정 > 고급 설정 표시 > 프록시 설정 변경...
- 익스폴러러 10: 도구 > 인터넷 옵션에서 '연결' 선택 > LAN 설정 > LAN에 프락시 서버 사용

위와 같은 방법으로 프락시를 수동으로 설정할 수 있다. 프락시 수동 설정에는 호스트와 포트를 지정한다. 그리고 몇몇 [ISP](https://namu.wiki/w/ISP)는 그들의 요구에 맞춰 미리 설정된 브라우저나 웹 트래픽을 프락시 서버로 리다이렉트 하는 맞춤형 운영 체제를 구입한다.

수동 프락시 설정은 단순하지만 반면에 유연하지 못하다. 그 이유는 **모든 콘텐츠를 위해 단 하나의 프락시 서버만을 지정할 수 있고, 장애 시의 대체 작동에 대한 지원도 없다.** 이러한 설정 방식은 큰 조직에서는 관리 문제를 야기한다. 설정된 브라우저가 매우 많다면, 모두가 원하는 대로 설정 변경하는 것은 어려운 일이다.

<br />
<br />

## 6.4.2 클라이언트 프락시 설정: PAC 파일

프락시 자동 설정(PAC) 파일은 수동 설정에 비해 동적인 해결책이다. 프락시 설정을 그때그때 상황에 맞게 계산해주는 **작은 자바스크립트 프로그램이기 때문이다.** 문서에 접근할 때마다, 자바스크립트 함수가 적적한 프락시 서버를 선택한다.

PAC 파일을 사용하려면, **자바스크립트 PAC파일의 URI를 브라우저에 설정해야 한다.** 그러면 브라우저는 URI로부터 PAC 파일을 가져와서 매 접근마다 적절한 프락시 서버를 계산하기 위해 자바스크립트 로직을 이용할 것이다. PAC 파일은 일반적으로 '.pac' 확장자를 가지며 MIME 타입은 'application/x-ns-proxy-autoconfig'이다.

<br />

```js
// findProxyForURL.pac

function FindProxyForURL(url, host) {
  if (url.substring(0, 5) === 'http:') {
    return 'PROXY ftp-proxy.mydomain.com:8080';
  } else if (url.substring(0, 5) === 'ftp:') {
    return 'PROXY ftp-proxy.mydomain.com:8080';
  } else {
    return 'DIRECT';
  }
}
```

<br />

PAC 파일은 HTTP 트랜잭션과 FTP 트랜잭션에 대해 각각 사용할 프락시를 알려주고, 그 외의 다른 모든 종류의 트랜잭션에 대해서는 직접 연결을 하도록 지시한다.

<br />

|FindProxyForURL 반환값|설명|
|---|---|
|DIRECT|프락시 없이 연결이 직접 이루어져야 한다.|
|PROXY host:post|지정한 프락시를 사용해야 한다.|
|SOCKS host:port|지정한 SOCKS 서버를 사용해야 한다.|

> SOCKS란? Socket Secure(SOCKS)는 프록시 서버가 서버와 클라이언트 간에 네트워크 패킷을 라우팅하는 데 사용하는 인터넷 프로토콜이다.

[출처: SOCKS란 무엇인가요?](https://support.nordvpn.com/ko/%EC%9D%BC%EB%B0%98-%EC%A0%95%EB%B3%B4/1834627542/SOCKS%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%9A%94.htm)

<br />
<br />

## 6.4.3 클라이언트 프락시 설정: WPAD

WPAD는 여러 발견 메커니즘들의 상승 전략을 이용해 브라우저에게 알맞는 **WPAD 파일을 자동으로 찾아주는 알고리즘이다.** WPAD 프로토콜이 구현된 클라이언트가 하게 될 일은 다음과 같다.

- PAC URI를 찾기 위해 WPAD를 사용한다.
- 주어진 URI에서 PAC 파일을 가져온다.
- 프락시 서버를 알아내기 위해 PAC 파일을 실행한다.
- 알아낸 프락시 서버를 이용해서 요청을 처리한다.

<br />

WPAD는 **올바른 PAC 파일을 알아내기 위해 일련의 리소스 발견 기법을 사용한다.** WPAD는 성공할 때까지 각 기법을 하나씩 시도해본다. 현재의 WPAD 명세는 아래와 같은 기법을 순서대로 정의한다.

- 동적 호스트 발견 규약(DHCP)
- 서비스 위치 규약(SLP)
- DNS 잘 알려진 호스트 명
- DNS SRV 레코드
- DNS TXT 레코드 안의 서비스 URI